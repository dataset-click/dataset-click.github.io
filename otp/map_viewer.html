<!DOCTYPE html>
<html>
<head>
  <title>OTP Route Viewer</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    #map { height: 100vh; width: 100vw; }
  </style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@mapbox/polyline"></script>

<script>
const from = [-37.8079, 144.9560];
const to = [-37.8183, 144.9671];

const map = L.map('map').setView(from, 14);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

L.marker(from).addTo(map).bindPopup('Origin').openPopup();
L.marker(to).addTo(map).bindPopup('Destination');

const url = `https://ptplanner.latrobe.edu.au/otp/routers/vic/plan?fromPlace=${from[0]},${from[1]}&toPlace=${to[0]},${to[1]}&mode=TRANSIT,WALK&date=2025-09-13&time=08:00am`;

fetch(url)
  .then(res => res.json())  // <-- handle JSON not XML
  .then(data => {
    const itinerary = data.plan?.itineraries?.[0];
    if (!itinerary) {
      alert("No route found.");
      return;
    }

    itinerary.legs.forEach(leg => {
      const encoded = leg.legGeometry.points;
      const decoded = polyline.decode(encoded);
      const latlngs = decoded.map(([lat, lng]) => [lat, lng]);
      L.polyline(latlngs, { color: 'blue', weight: 4 }).addTo(map);
    });
  })
  .catch(err => console.error("Error fetching route:", err));
</script>
</body>
</html>
